# 三国 SLG 改进建议

## 🚨 核心问题

### 1. 地图太大，行军太慢
- **现状**：100x100 地图，双方出生点相距约 100 格
- **问题**：每回合移动 3-8 格，需要 20+ 回合才能相遇，非常无聊
- **建议**：
  - 缩小地图到 20x20 或 30x30
  - 或者双方出生在城池附近（距离城池 5-10 格）
  - 或者提供"快速行军"模式，非战斗时移动距离翻倍

### 2. 地形障碍物太多
- **现状**：大量移动操作返回"目标位置不可达"
- **问题**：AI 难以找到有效路径，游戏体验差
- **建议**：
  - 减少山地/河流等障碍物密度
  - 提供路径规划 API，返回可达区域
  - 添加 `/api/games/:id/moveable?instance_id=xxx` 接口

### 3. API 缺少关键信息
- **现状**：
  - `current_player` 返回值有时不准确
  - 没有可移动范围的 API
  - 没有可攻击目标的 API
- **建议**：
  - 添加 `GET /api/games/:id/actions?instance_id=xxx` 返回当前武将可执行的所有操作
  - 包含：可移动格子列表、可攻击目标列表、可用技能等

## 🎮 游戏体验改进

### 4. Ban/Pick 流程太长
- **现状**：4 轮 Ban + 6 轮 Pick = 10 个阶段
- **建议**：
  - 简化为 2 Ban + 3 Pick
  - 或提供"快速模式"跳过 Ban/Pick，随机分配武将

### 5. 缺少游戏进度可视化
- **建议**：
  - 添加简易 ASCII 地图显示
  - 或提供 Web UI 查看战场

### 6. 胜利条件不明确
- **现状**：击杀主将或占领城池 3 回合
- **问题**：城池在地图中央，双方要走很久
- **建议**：
  - 城池应该更容易到达
  - 或添加其他胜利条件（如消灭所有敌人）

## 🛠️ 技术改进

### 7. Durable Objects 状态同步
- 有时候 API 返回的 `current_player` 和实际可操作的玩家不一致
- 需要检查状态同步逻辑

### 8. TiDB 集成
- `affectedRows` 返回值有问题
- 建议用 Durable Objects 作为主要数据源，TiDB 仅作备份/分析

### 9. 错误信息不友好
- "目标位置不可达"应该说明原因（障碍物？距离太远？）
- 添加更详细的错误码和信息

## 📋 优先级

1. **P0 - 必须修复**：缩小地图 / 调整出生点
2. **P1 - 重要**：添加可移动范围 API
3. **P2 - 改进**：简化 Ban/Pick 流程
4. **P3 - 优化**：Web UI 可视化

---

*记录时间：2026-02-02*
*测试回合数：31*
*实际战斗发生：0 次*
*结论：地图设计需要大改*
